;-------------------------------------------------------------------------;
.include "copying.inc"
.include "snes.inc"
.include "snes_zvars.inc"
;-------------------------------------------------------------------------;

map		= memptr
gfx		= m0
copy_m7_map	= m5
map_entry	= m6
max_map_entry	= m7
tile_xpos	= m5+1


;/////////////////////////////////////////////////////////////////////////;
; Store map address into memptr & map bank into memptr+2
; load gfx bank into a
; load gfx address into x
; load max max map entry into y
;/////////////////////////////////////////////////////////////////////////;
.code
;/////////////////////////////////////////////////////////////////////////;


;-------------------------------------------------------------------------;
	.a8
	.i16
;-------------------------------------------------------------------------;


;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
Copy256x256Mode7Gfx:
;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
	sta	gfx+2
	stx	gfx
	sty	max_map_entry

	lda	#1
	sta	copy_m7_map
	ldy	#0000h
	sty	map_entry
	sty	REG_VMADDL
;-------------------------------------------------------------------------;
:	tyx
	jsr	Copy256x256Mode7Map
	txy
	lda	[gfx],y
	sta	REG_VMDATAH
	iny
	cpy	#4000h
	bne	:-
;-------------------------------------------------------------------------;
	ldx	#0000h
	stx	copy_m7_map
	stx	gfx
	stx	map_entry
	stx	max_map_entry
	rts


;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
Copy256x256Mode7Map:
;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
	lda	copy_m7_map
	bne	cmp21h
;-------------------------------------------------------------------------;
cmp61h:	inc	tile_xpos
	lda	tile_xpos
	cmp	#61h
	bne	zvmdl
;-------------------------------------------------------------------------;
	stz	tile_xpos
	lda	#01h
	sta	copy_m7_map
;-------------------------------------------------------------------------;
cmp21h:	inc	tile_xpos
	lda	tile_xpos
	cmp	#21h
	bne	cmpmap
;-------------------------------------------------------------------------;
	stz	tile_xpos
	stz	copy_m7_map
	bra	cmp61h
;-------------------------------------------------------------------------;
zvmdl:	stz	REG_VMDATAL
	rts
;-------------------------------------------------------------------------;
cmpmap:	ldy	map_entry
	cpy	max_map_entry	; only a 256x256 map
	beq	zvmdl
;-------------------------------------------------------------------------;
	lda	[map],y		; get map data
	sta	REG_VMDATAL
	iny
	sty	map_entry
	rts
;-------------------------------------------------------------------------;
