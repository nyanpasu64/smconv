;-------------------------------------------------------------------------;
.include "hdma_lines.inc"
.include "snes.inc"
;-------------------------------------------------------------------------;
.importzp shadow_hdmaen
;-------------------------------------------------------------------------;


;/////////////////////////////////////////////////////////////////////////;
.bss
;/////////////////////////////////////////////////////////////////////////;


;-------------------------------------------------------------------------;
line_counter:
	.res 2
line_delay:
	.res 1
;-------------------------------------------------------------------------;


;/////////////////////////////////////////////////////////////////////////;
.zeropage
;/////////////////////////////////////////////////////////////////////////;


;-------------------------------------------------------------------------;
ram_ptr:
	.res 3
;-------------------------------------------------------------------------;


;/////////////////////////////////////////////////////////////////////////;
.code
;/////////////////////////////////////////////////////////////////////////;


;=========================================================================;
;       Code (c) 1995 -Pan-/ANTHROX   All code can be used at will!
;=========================================================================;                     

	.a8
	.i16


;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
SetupHDMALines:
;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
	rep	#10h
	sep	#20h

	stx	ram_ptr

	ldx	#0300h
	stx	line_counter
	stz	line_delay

	ldy	#0000h

	lda	#0ffh
	xba
	lda	#01h
:	sta	(ram_ptr),y
	dea
	iny
	sta	(ram_ptr),y
	ina
	iny
	sta	(ram_ptr),y
	iny
	cpy	#0300h
	bne	:-

:	sta	(ram_ptr),y
	iny
	xba
	sta	(ram_ptr),y
	dea
	xba
	dea
	iny
	sta	(ram_ptr),y
	ina
	iny
	cpy	#0600h
	bne	:-

	lda     #DMAP_XFER_MODE_2
	sta     REG_DMAP0
	lda     #<REG_BG1VOFS
	sta     REG_BBAD0
	ldx     ram_ptr
	stx     REG_A1T0L
	stz     REG_A1B0

	lda	#%1
	sta	shadow_hdmaen
	sta	REG_HDMAEN

	rts



;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
HDMALines:
;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
	rep	#30h

	lda	ram_ptr

	clc
	adc	line_counter
	sta     REG_A1T0L         

	sep	#20h

	lda	line_delay
	eor	#01h
	sta	line_delay
	beq	:+
	rts
;-------------------------------------------------------------------------;
:	ldx	line_counter
	dex
	dex
	dex
	stx	line_counter

	rts
