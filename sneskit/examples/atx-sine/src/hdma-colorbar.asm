;-------------------------------------------------------------------------;
.include "hdma_colorbar.inc"
.include "snes.inc"
.include "snes_zvars.inc"
;-------------------------------------------------------------------------;
; The following source code was written on an Amiga 4000/040 computer using
; CygnusEd (text editor), SASM (snes assembler), IFF2SNES (gfx converter).
; This is a horrible piece of code and shows very sloppy work.
; The only equates used are by the un-packer (which was hand written and
; is a simple sequence unpacker, the packer itself was written in 68000 by
; me using ASM-One). 
;-------------------------------------------------------------------------;


;-------------------------------------------------------------------------;
RAM_CGADD = 000900h	;7e8000h
RAM_CGDATA = 000b00h	;7e8500h
RAM_COLORBAR = 000e00h	;7ea000h
;-------------------------------------------------------------------------;


;/////////////////////////////////////////////////////////////////////////;
.zeropage
;/////////////////////////////////////////////////////////////////////////;


;-------------------------------------------------------------------------;
sineoffblu: .res 2
sineoffgrn: .res 2
sineoffred: .res 2
storage2: .res 2
;-------------------------------------------------------------------------;


;=========================================================================;
;      Code (c) 1993-94 -Pan-/ANTHROX   All code can be used at will!
;=========================================================================;
                     

;/////////////////////////////////////////////////////////////////////////;
.code
;/////////////////////////////////////////////////////////////////////////;


	.a8
	.i16


;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
SetupHDMAColorBar:
;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
	ldx	#RAM_COLORBAR
	stx	memptr
	lda	#^RAM_COLORBAR
	sta	memptr+2	; lda [memptr] is equal to lda 7ea000h

	jsr	HDMA

	rts

;=========================================================================;
;                      HDMA Setup
;=========================================================================;
HDMA:
;=========================================================================;
	rep	#10h
	sep	#20h

	ldx	#0000h
	txy
	lda	#00h
;-------------------------------------------------------------------------;
ClearHram:
;-------------------------------------------------------------------------;
	sta	.loword(RAM_CGADD),x
	inx
	cpx	#0700h
	bne	ClearHram
;-------------------------------------------------------------------------;
	tyx
;-------------------------------------------------------------------------;
PalSetup:
;-------------------------------------------------------------------------;
	ina
	sta	.loword(RAM_CGADD),x
	dea
	inx
	sta	.loword(RAM_CGADD),x
	inx
	cpx	#00ffh*2
	bne	PalSetup
;-------------------------------------------------------------------------;
	sta	.loword(RAM_CGADD),x
	sta	.loword(RAM_CGADD+1),x
;-------------------------------------------------------------------------;
	tyx
;-------------------------------------------------------------------------;
Colsetup:
;-------------------------------------------------------------------------;
	ina
	sta	.loword(RAM_CGDATA),x
	dea
	inx
	sta	.loword(RAM_CGDATA),x
	inx
	sta	.loword(RAM_CGDATA),x
	inx
	cpx	#00ffh*3
	bne	Colsetup
;-------------------------------------------------------------------------;
	sta	.loword(RAM_CGDATA),x
	sta	.loword(RAM_CGDATA+1),x
	sta	.loword(RAM_CGDATA+2),x

	stz	REG_DMAP0		; 0= 1 byte per register (not a word!)
	lda	#<REG_CGADD
	sta	REG_BBAD0		; 21xx   this is 2118 (VRAM)
	ldx	#RAM_CGADD
	stx	REG_A1T0L
	;lda	#^RAM_CGADD
	stz	REG_A1B0		; bank address of data in ram
	stz	REG_A1B1

	lda	#DMAP_XFER_MODE_2
	sta	REG_DMAP1		; 0= 1 byte per register (not a word!)
	lda	#<REG_CGDATA
	sta	REG_BBAD1		; 21xx   this is 2118 (VRAM)
	ldx	#RAM_CGDATA
	stx	REG_A1T1L

	;jsr	WaitVb

	lda	#%11
	sta	REG_HDMAEN

	ldx     #0000h                                 
	stx     sineoffred      ; sine offset for red  
	stx     sineoffgrn      ; sine offset for green
	ldx	#0030h
	stx     sineoffblu      ; sine offset for blue
	stx	storage2	; storage
;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
HDMAColorBar:
;:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;
	lda	#7eh
	pha
	plb

	ldx	#0000h
	txy
;-------------------------------------------------------------------------;
CopyFXColors:
;-------------------------------------------------------------------------;
	lda	(memptr),y
	sta	.loword(RAM_CGDATA)+01h,x
	iny
	inx
	lda	(memptr),y
	sta	.loword(RAM_CGDATA)+01h,x
	iny
	inx
	lda	#01h
	sta	RAM_CGDATA+01h,x
	inx
	cpy	#0200h
	bne	CopyFXColors
;-------------------------------------------------------------------------;
	rep	#30h

	ldx	#0000h
	lda	#00h
;-------------------------------------------------------------------------;
ClearColorRam:
;-------------------------------------------------------------------------;
	sta	.loword(RAM_COLORBAR),x
	inx
	inx
	cpx	#0200h
	bne	ClearColorRam
;-------------------------------------------------------------------------;
	sep	#20h

	lda	#80h
	pha
	plb

	ldx	#REDS
	ldy	sineoffred
	jsr	CopyColor

	ldx	#GREENS
	ldy	sineoffgrn
	jsr	CopyColor

	ldx	#BLUES
	ldy	sineoffblu
	jsr	CopyColor

	inc	sineoffred
	inc	sineoffred
	dec	sineoffgrn
	inc	sineoffblu

	rts


;-------------------------------------------------------------------------;
CopyColor:
;-------------------------------------------------------------------------;
	stx	m6
	inx
	stx	m7

	rep	#30h

	lda	COLOR_SINE,y
	and	#00ffh
	asl a
	sta	storage2
	tax

	sep	#20h

	ldy	#0000h
;-------------------------------------------------------------------------;
:	lda	(m6),y
	ora	.loword(RAM_COLORBAR),x
	sta	.loword(RAM_COLORBAR),x
	lda	(m6),y
	ora	.loword(RAM_COLORBAR+02h),x
	sta	.loword(RAM_COLORBAR+02h),x
	lda	(m7),y
	ora	.loword(RAM_COLORBAR+01h),x
	sta	.loword(RAM_COLORBAR+01h),x
	lda	(m7),y
	ora	.loword(RAM_COLORBAR+03h),x
	sta	.loword(RAM_COLORBAR+03h),x
	inx
	inx
	inx
	inx
	iny
	iny
	cpy	#0020h
	bne	:-
;-------------------------------------------------------------------------;
	rts



;/////////////////////////////////////////////////////////////////////////;
.code
;/////////////////////////////////////////////////////////////////////////;


;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;
COLOR_SINE:
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;
 .byte	091,093,095,098,100,102,104,107,109,111,113,115,117,120,122,124
 .byte	126,128,130,132,134,136,138,140,142,143,145,147,149,150,152,154
 .byte	155,157,158,160,161,163,164,165,167,168,169,170,171,172,173,174
 .byte	175,176,177,177,178,179,179,180,180,181,181,181,182,182,182,182
 .byte	182,182,182,182,182,181,181,181,180,180,179,179,178,177,177,176
 .byte	175,174,173,172,171,170,169,168,167,165,164,163,161,160,158,157
 .byte	155,154,152,150,149,147,145,143,142,140,138,136,134,132,130,128
 .byte	126,124,122,120,117,115,113,111,109,107,104,102,100,098,095,093
 .byte	091,089,087,084,082,080,078,075,073,071,069,067,065,062,060,058
 .byte	056,054,052,050,048,046,044,042,040,039,037,035,033,032,030,028
 .byte	027,025,024,022,021,019,018,017,015,014,013,012,011,010,009,008
 .byte	007,006,005,005,004,003,003,002,002,001,001,001,000,000,000,000
 .byte	000,000,000,000,000,001,001,001,002,002,003,003,004,005,005,006
 .byte	007,008,009,010,011,012,013,014,015,017,018,019,021,022,024,025
 .byte	027,028,030,032,033,035,037,039,040,042,044,046,048,050,052,054
 .byte	056,058,060,062,065,067,069,071,073,075,078,080,082,084,087,089
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;


;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;
REDS:
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;
	;.incbin "../colorbars/004.col"
	.word	$0006,$0008,$000a,$000c,$000e,$0010,$0012,$0014
	.word	$0014,$0012,$0010,$000e,$000c,$000a,$0008,$0006
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;


;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;
GREENS:
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;
	;.incbin "../colorbars/005.col"
	.word	$00c0,$0100,$0140,$0180,$01c0,$0200,$0240,$0280
	.word	$0280,$0240,$0200,$01c0,$0180,$0140,$0100,$00c0
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;


;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;
BLUES:
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;
	;.incbin "../colorbars/006.col"
 	.word	$1800,$2000,$2800,$3000,$3800,$4000,$4800,$5000
	.word	$5000,$4800,$4000,$3800,$3000,$2800,$2000,$1800
;=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=;


